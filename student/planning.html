<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduFlex - Planning</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/etud-style.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar py-3">
        <div class="text-center py-3 mb-3">
            <a class="navbar-brand fw-bold" href="../index.html">
                <span class="text-gradient fs-4">EduFlex</span>
            </a>
        </div>
        <div class="px-3">
            <div class="position-relative mb-4">
                <input type="text" class="form-control search-input py-2" placeholder="Rechercher...">
                <i class="fas fa-search search-icon"></i>
            </div>
            <p class="text-muted small text-uppercase ms-3 mb-2">Principal</p>
            <ul class="nav flex-column mb-4">
                <li class="nav-item">
                    <a class="nav-link" href="student-dashboard.html">
                        <i class="fas fa-th-large"></i> Tableau de bord
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="my-courses.html">
                        <i class="fas fa-book"></i> Mes cours
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="planning.html">
                        <i class="fas fa-calendar-alt"></i> Planning
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="assignments.html">
                        <i class="fas fa-tasks"></i> Devoirs
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="quiz.html">
                        <i class="fas fa-question-circle"></i> Quiz
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="certificates.html">
                        <i class="fas fa-certificate"></i> Certificats
                    </a>
                </li>
            </ul>
            <p class="text-muted small text-uppercase ms-3 mb-2">Communauté</p>
            <ul class="nav flex-column mb-4">
                <li class="nav-item">
                    <a class="nav-link" href="forum.html">
                        <i class="fas fa-users"></i> Forum
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="messages.html">
                        <i class="fas fa-comments"></i> Messages
                        <span class="badge rounded-pill bg-danger float-end">3</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="conferences.html">
                        <i class="fas fa-video"></i> Conférences
                    </a>
                </li>
            </ul>
            <p class="text-muted small text-uppercase ms-3 mb-2">Compte</p>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="profile.html">
                        <i class="fas fa-user-circle"></i> Profil
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="etud-param.html">
                        <i class="fas fa-cog"></i> Paramètres
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../index.html">
                        <i class="fas fa-sign-out-alt"></i> Déconnexion
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navbar -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0 fw-bold">Planning</h2>
            <div class="d-flex align-items-center">
                <div class="position-relative me-3">
                    <button class="btn btn-light position-relative" type="button">
                        <i class="far fa-bell"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            2
                        </span>
                    </button>
                </div>
                <div class="dropdown navbar-profile">
                    <a class="dropdown-toggle d-flex align-items-center" href="#" role="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="https://placehold.co/200x200?text=M" alt="Profile" class="avatar me-2">
                        <div>
                            <p class="mb-0 fw-medium">Marie Dupont</p>
                            <p class="text-muted small mb-0">Étudiante</p>
                        </div>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="profileDropdown">
                        <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user-circle"></i> Mon profil</a></li>
                        <li><a class="dropdown-item" href="certificates.html"><i class="fas fa-certificate"></i> Mes certificats</a></li>
                        <li><a class="dropdown-item" href="etud-param.html"><i class="fas fa-cog"></i> Paramètres</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="../index.html"><i class="fas fa-sign-out-alt"></i> Déconnexion</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Calendar Tools Row -->
        <div class="row g-4 mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="d-flex align-items-center">
                                <div class="btn-group me-3">
                                    <button id="prev-btn" class="btn btn-outline-secondary">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <button id="today-btn" class="btn btn-outline-primary">Aujourd'hui</button>
                                    <button id="next-btn" class="btn btn-outline-secondary">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                <h4 id="calendar-title" class="mb-0 fw-bold">Mai 2025</h4>
                            </div>
                            <div class="d-flex">
                                <div class="btn-group me-3">
                                    <button class="btn btn-outline-secondary" id="month-view">Mois</button>
                                    <button class="btn btn-outline-secondary" id="week-view">Semaine</button>
                                    <button class="btn btn-outline-secondary" id="day-view">Jour</button>
                                    <button class="btn btn-outline-secondary" id="list-view">Liste</button>
                                </div>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEventModal">
                                    <i class="fas fa-plus me-1"></i> Ajouter un événement
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Rows -->
        <div class="row g-4">
            <!-- Calendar -->
            <div class="col-md-9">
                <div class="card h-100">
                    <div class="card-body" id="calendar"></div>
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="col-md-3">
                <div class="card mb-4">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0 fw-bold">Événements à venir</h5>
                    </div>
                    <div class="card-body p-3">
                        <div class="timeline">
                            <div class="timeline-item">
                                <p class="mb-1 fw-medium">Aujourd'hui</p>
                                <div class="card schedule-card p-2 mb-2">
                                    <div class="d-flex align-items-center">
                                        <span class="badge badge-ai me-2">IA</span>
                                        <div>
                                            <p class="mb-0 fw-medium">Modèles de Machine Learning</p>
                                            <p class="text-muted small mb-0">09:00 - 10:30</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card schedule-card p-2 mb-0">
                                    <div class="d-flex align-items-center">
                                        <span class="badge badge-live me-2">Live</span>
                                        <div>
                                            <p class="mb-0 fw-medium">Q&R avec formateur</p>
                                            <p class="text-muted small mb-0">14:00 - 15:00</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <p class="mb-1 fw-medium">Demain</p>
                                <div class="card schedule-card p-2 mb-0">
                                    <div class="d-flex align-items-center">
                                        <span class="badge badge-course me-2">Web</span>
                                        <div>
                                            <p class="mb-0 fw-medium">Workshop React</p>
                                            <p class="text-muted small mb-0">10:00 - 12:30</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <p class="mb-1 fw-medium">12 Mai, 2025</p>
                                <div class="card schedule-card p-2 mb-2">
                                    <div class="d-flex align-items-center">
                                        <span class="badge badge-ai me-2">Data</span>
                                        <div>
                                            <p class="mb-0 fw-medium">Date limite projet</p>
                                            <p class="text-muted small mb-0">Avant 23:59</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card schedule-card p-2 mb-0">
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-danger me-2">Important</span>
                                        <div>
                                            <p class="mb-0 fw-medium">Quiz d'évaluation</p>
                                            <p class="text-muted small mb-0">14:00 - 15:30</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <p class="mb-1 fw-medium">15 Mai, 2025</p>
                                <div class="card schedule-card p-2 mb-0">
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-info text-white me-2">Nouveau</span>
                                        <div>
                                            <p class="mb-0 fw-medium">Webinaire IA avancée</p>
                                            <p class="text-muted small mb-0">18:00 - 19:30</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Color Legend -->
                <div class="card">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0 fw-bold">Légende</h5>
                    </div>
                    <div class="card-body p-3">
                        <div class="d-flex align-items-center mb-2">
                            <div class="bg-primary" style="width: 15px; height: 15px; border-radius: 3px;"></div>
                            <span class="ms-2">Cours réguliers</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <div class="bg-success" style="width: 15px; height: 15px; border-radius: 3px;"></div>
                            <span class="ms-2">Travaux pratiques</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <div class="bg-danger" style="width: 15px; height: 15px; border-radius: 3px;"></div>
                            <span class="ms-2">Examens & évaluations</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <div class="bg-warning" style="width: 15px; height: 15px; border-radius: 3px;"></div>
                            <span class="ms-2">Sessions live</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="bg-info" style="width: 15px; height: 15px; border-radius: 3px;"></div>
                            <span class="ms-2">Événements spéciaux</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addEventModalLabel">Ajouter un événement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addEventForm">
                        <div class="mb-3">
                            <label for="eventTitle" class="form-label">Titre de l'événement</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="eventStartDate" class="form-label">Date de début</label>
                                <input type="date" class="form-control" id="eventStartDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="eventStartTime" class="form-label">Heure de début</label>
                                <input type="time" class="form-control" id="eventStartTime" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="eventEndDate" class="form-label">Date de fin</label>
                                <input type="date" class="form-control" id="eventEndDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="eventEndTime" class="form-label">Heure de fin</label>
                                <input type="time" class="form-control" id="eventEndTime" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="eventCategory" class="form-label">Catégorie</label>
                            <select class="form-select" id="eventCategory" required>
                                <option value="">Choisir une catégorie</option>
                                <option value="course">Cours régulier</option>
                                <option value="practical">Travaux pratiques</option>
                                <option value="exam">Examen</option>
                                <option value="live">Session live</option>
                                <option value="special">Événement spécial</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="eventDescription" class="form-label">Description (optionnelle)</label>
                            <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="eventReminder">
                            <label class="form-check-label" for="eventReminder">
                                Me rappeler avant l'événement
                            </label>
                        </div>
                        <div class="mb-3 reminder-options d-none">
                            <label for="reminderTime" class="form-label">Rappel</label>
                            <select class="form-select" id="reminderTime">
                                <option value="15">15 minutes avant</option>
                                <option value="30">30 minutes avant</option>
                                <option value="60">1 heure avant</option>
                                <option value="120">2 heures avant</option>
                                <option value="1440">1 jour avant</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" id="saveEventBtn">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div class="modal fade" id="eventDetailsModal" tabindex="-1" aria-labelledby="eventDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventDetailsModalLabel">Détails de l'événement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h4 id="detailTitle" class="mb-3"></h4>
                    <div class="mb-3">
                        <i class="far fa-calendar-alt me-2"></i>
                        <span id="detailDate"></span>
                    </div>
                    <div class="mb-3">
                        <i class="far fa-clock me-2"></i>
                        <span id="detailTime"></span>
                    </div>
                    <div class="mb-3">
                        <i class="fas fa-tag me-2"></i>
                        <span id="detailCategory"></span>
                    </div>
                    <div class="mb-4">
                        <i class="far fa-file-alt me-2"></i>
                        <span id="detailDescription">Pas de description</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-end">
                        <button type="button" class="btn btn-outline-danger me-2" id="deleteEventBtn">
                            <i class="far fa-trash-alt me-1"></i> Supprimer
                        </button>
                        <button type="button" class="btn btn-primary" id="editEventBtn">
                            <i class="far fa-edit me-1"></i> Modifier
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize reminder toggle
            document.getElementById('eventReminder').addEventListener('change', function() {
                const reminderOptions = document.querySelector('.reminder-options');
                if (this.checked) {
                    reminderOptions.classList.remove('d-none');
                } else {
                    reminderOptions.classList.add('d-none');
                }
            });
            
            // Initialize FullCalendar
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: false, // We're using custom header
                locale: 'fr',
                firstDay: 1, // Monday
                height: 'auto',
                contentHeight: 'auto',
                aspectRatio: 2,
                showNonCurrentDates: true,
                editable: true,
                selectable: true,
                selectMirror: true,
                dayMaxEvents: true,
                events: [
                    {
                        id: '1',
                        title: 'Modèles de Machine Learning',
                        start: '2025-05-10T09:00:00',
                        end: '2025-05-10T10:30:00',
                        color: '#5461FF',
                        description: 'Session en ligne avec Prof. Martin',
                        category: 'Course'
                    },
                    {
                        id: '2',
                        title: 'Introduction à React',
                        start: '2025-05-10T11:00:00',
                        end: '2025-05-10T12:30:00',
                        color: '#36B37E',
                        description: 'Travaux pratiques: création de composants',
                        category: 'Practical'
                    },
                    {
                        id: '3',
                        title: 'Q&R avec formateur',
                        start: '2025-05-10T14:00:00',
                        end: '2025-05-10T15:00:00',
                        color: '#FFAB00',
                        description: 'Session interactive',
                        category: 'Live'
                    },
                    {
                        id: '4',
                        title: 'Analyse de données',
                        start: '2025-05-10T16:00:00',
                        end: '2025-05-10T17:30:00',
                        color: '#5D7DFF',
                        description: 'Mini-projet',
                        category: 'Practical'
                    },
                    {
                        id: '5',
                        title: 'Workshop React',
                        start: '2025-05-11T10:00:00',
                        end: '2025-05-11T12:30:00',
                        color: '#36B37E',
                        description: 'Travaux pratiques avancés',
                        category: 'Practical'
                    },
                    {
                        id: '6',
                        title: 'Date limite projet',
                        start: '2025-05-12T23:59:00',
                        allDay: true,
                        color: '#5D7DFF',
                        description: 'Remise du projet Data Science',
                        category: 'Deadline'
                    },
                    {
                        id: '7',
                        title: 'Quiz d\'évaluation',
                        start: '2025-05-12T14:00:00',
                        end: '2025-05-12T15:30:00',
                        color: '#FF5630',
                        description: 'Quiz sur les fondamentaux de l\'IA',
                        category: 'Exam'
                    },
                    {
                        id: '8',
                        title: 'Webinaire IA avancée',
                        start: '2025-05-15T18:00:00',
                        end: '2025-05-15T19:30:00',
                        color: '#00B8D9',
                        description: 'Présentation des dernières avancées',
                        category: 'Special'
                    }
                ],
                select: function(info) {
                    // Set date values in the add event modal
                    const startDate = new Date(info.start);
                    const endDate = info.end ? new Date(info.end) : new Date(startDate);
                    endDate.setMinutes(endDate.getMinutes() - 1); // Adjust for FullCalendar's exclusive end date
                    
                    // Format dates for form fields
                    document.getElementById('eventStartDate').value = startDate.toISOString().slice(0, 10);
                    document.getElementById('eventEndDate').value = endDate.toISOString().slice(0, 10);
                    
                    // Open the modal
                    const addEventModal = new bootstrap.Modal(document.getElementById('addEventModal'));
                    addEventModal.show();
                },
                eventClick: function(info) {
                    // Populate event details modal
                    document.getElementById('detailTitle').textContent = info.event.title;
                    
                    // Format date
                    const startDate = info.event.start;
                    const endDate = info.event.end || new Date(startDate.getTime() + 3600000); // Default 1 hour if no end time
                    
                    const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    document.getElementById('detailDate').textContent = startDate.toLocaleDateString('fr-FR', dateOptions);
                    
                    // Format time
                    const timeOptions = { hour: '2-digit', minute: '2-digit' };
                    const timeText = startDate.toLocaleTimeString('fr-FR', timeOptions) + ' - ' + 
                                    endDate.toLocaleTimeString('fr-FR', timeOptions);
                    document.getElementById('detailTime').textContent = timeText;
                    
                    // Category
                    document.getElementById('detailCategory').textContent = info.event.extendedProps.category || 'Non catégorisé';
                    
                    // Description
                    document.getElementById('detailDescription').textContent = info.event.extendedProps.description || 'Pas de description';
                    
                    // Open the modal
                    const detailsModal = new bootstrap.Modal(document.getElementById('eventDetailsModal'));
                    detailsModal.show();
                }
            });
            
            calendar.render();
            
            // Connect custom toolbar buttons
            document.getElementById('prev-btn').addEventListener('click', function() {
                calendar.prev();
                updateCalendarTitle();
            });
            
            document.getElementById('next-btn').addEventListener('click', function() {
                calendar.next();
                updateCalendarTitle();
            });
            
            document.getElementById('today-btn').addEventListener('click', function() {
                calendar.today();
                updateCalendarTitle();
            });
            
            document.getElementById('month-view').addEventListener('click', function() {
                calendar.changeView('dayGridMonth');
                updateViewButtons(this);
            });
            
            document.getElementById('week-view').addEventListener('click', function() {
                calendar.changeView('timeGridWeek');
                updateViewButtons(this);
            });
            
            document.getElementById('day-view').addEventListener('click', function() {
                calendar.changeView('timeGridDay');
                updateViewButtons(this);
            });
            
            document.getElementById('list-view').addEventListener('click', function() {
                calendar.changeView('listWeek');
                updateViewButtons(this);
            });
            
            // Initial setup
            updateCalendarTitle();
            updateViewButtons(document.getElementById('month-view'));
            
            // Save event button
            document.getElementById('saveEventBtn').addEventListener('click', function() {
                const title = document.getElementById('eventTitle').value;
                const startDate = document.getElementById('eventStartDate').value;
                const startTime = document.getElementById('eventStartTime').value;
                const endDate = document.getElementById('eventEndDate').value;
                const endTime = document.getElementById('eventEndTime').value;
                const category = document.getElementById('eventCategory').value;
                const description = document.getElementById('eventDescription').value;
                
                // Validate form
                if (!title || !startDate || !startTime || !endDate || !endTime || !category) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }
                
                // Create event object
                const eventColor = getCategoryColor(category);
                
                calendar.addEvent({
                    title: title,
                    start: `${startDate}T${startTime}`,
                    end: `${endDate}T${endTime}`,
                    color: eventColor,
                    description: description,
                    category: getCategoryName(category)
                });
                
             // Close modal and reset form
             const modal = bootstrap.Modal.getInstance(document.getElementById('addEventModal'));
                modal.hide();
                document.getElementById('addEventForm').reset();
                document.querySelector('.reminder-options').classList.add('d-none');
            });
            
            // Delete event button
            document.getElementById('deleteEventBtn').addEventListener('click', function() {
                // Get current event ID
                const currentEventId = this.getAttribute('data-event-id');
                const event = calendar.getEventById(currentEventId);
                
                if (event) {
                    // Confirm delete
                    if (confirm('Êtes-vous sûr de vouloir supprimer cet événement ?')) {
                        event.remove();
                        
                        // Close modal
                        const modal = bootstrap.Modal.getInstance(document.getElementById('eventDetailsModal'));
                        modal.hide();
                    }
                }
            });
            
            // Edit event button
            document.getElementById('editEventBtn').addEventListener('click', function() {
                // Get current event ID
                const currentEventId = this.getAttribute('data-event-id');
                const event = calendar.getEventById(currentEventId);
                
                if (event) {
                    // Fill the form with event data
                    document.getElementById('eventTitle').value = event.title;
                    
                    // Format dates and times
                    const startDate = event.start;
                    const endDate = event.end || new Date(startDate.getTime() + 3600000);
                    
                    // Format for input fields (YYYY-MM-DD and HH:MM)
                    document.getElementById('eventStartDate').value = startDate.toISOString().slice(0, 10);
                    document.getElementById('eventStartTime').value = startDate.toTimeString().slice(0, 5);
                    document.getElementById('eventEndDate').value = endDate.toISOString().slice(0, 10);
                    document.getElementById('eventEndTime').value = endDate.toTimeString().slice(0, 5);
                    
                    // Set category
                    const categoryValue = getCategoryValue(event.extendedProps.category);
                    document.getElementById('eventCategory').value = categoryValue;
                    
                    // Set description
                    document.getElementById('eventDescription').value = event.extendedProps.description || '';
                    
                    // Close details modal
                    const detailsModal = bootstrap.Modal.getInstance(document.getElementById('eventDetailsModal'));
                    detailsModal.hide();
                    
                    // Open edit modal
                    const addEventModal = new bootstrap.Modal(document.getElementById('addEventModal'));
                    document.getElementById('addEventModalLabel').textContent = 'Modifier l\'événement';
                    document.getElementById('saveEventBtn').setAttribute('data-mode', 'edit');
                    document.getElementById('saveEventBtn').setAttribute('data-event-id', currentEventId);
                    addEventModal.show();
                }
            });
            
            // Helper functions
            function updateCalendarTitle() {
                const viewTitle = calendar.view.title;
                document.getElementById('calendar-title').textContent = viewTitle;
            }
            
            function updateViewButtons(activeButton) {
                // Remove active class from all buttons
                document.querySelectorAll('.btn-group button').forEach(function(btn) {
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-outline-secondary');
                });
                
                // Add active class to clicked button
                activeButton.classList.remove('btn-outline-secondary');
                activeButton.classList.add('btn-primary');
            }
            
            function getCategoryColor(category) {
                const colorMap = {
                    'course': '#5461FF',
                    'practical': '#36B37E',
                    'exam': '#FF5630',
                    'live': '#FFAB00',
                    'special': '#00B8D9'
                };
                
                return colorMap[category] || '#5461FF';
            }
            
            function getCategoryName(category) {
                const nameMap = {
                    'course': 'Cours régulier',
                    'practical': 'Travaux pratiques',
                    'exam': 'Examen',
                    'live': 'Session live',
                    'special': 'Événement spécial'
                };
                
                return nameMap[category] || 'Non catégorisé';
            }
            
            function getCategoryValue(categoryName) {
                const valueMap = {
                    'Cours régulier': 'course',
                    'Travaux pratiques': 'practical',
                    'Examen': 'exam',
                    'Session live': 'live',
                    'Événement spécial': 'special'
                };
                
                return valueMap[categoryName] || '';
            }
            
            // Set up event details modal handlers
            calendar.on('eventClick', function(info) {
                document.getElementById('deleteEventBtn').setAttribute('data-event-id', info.event.id);
                document.getElementById('editEventBtn').setAttribute('data-event-id', info.event.id);
            });
            
            // Initialize view
            document.getElementById('month-view').click();
        });
    </script>
</body>
</html>